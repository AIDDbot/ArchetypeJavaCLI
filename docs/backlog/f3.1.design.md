# F3.1 Design â€” Resolve location via IP

## Goal

Provide a small, testable service that resolves approximate geographic coordinates using the configured IP Geolocation API (ip-api) when the user does not provide coordinates.

## Components

- IpGeoClient (package: com.aiddbot.archetype.cli.integrations.ipapi)
  - Responsibility: perform an HTTP GET to the configured `cli.endpoints.ip-geo-base-url` and parse the minimal JSON response.
  - Dependencies: `WebClient` bean, `CliProperties.Endpoints` for base URL.

- Domain model: `IpGeoResponse` (lat, lon, status, message)

## Interaction

1. Caller (Weather command or service) invokes `IpGeoClient.resolve()`.
2. `IpGeoClient` issues a GET to `${ipGeoBaseUrl}` with default Accept header.
3. Parse response; if `status` == `success` and lat/lon present, return coordinates.
4. If status != success or parsing fails, throw a `CodedException` with `ExitCodes.NETWORK` (or UNKNOWN if the payload is unexpected).

## Error handling

- Network errors (timeouts, 5xx): bubble as `CodedException(ExitCodes.NETWORK, "ip-geo failed: ...")`.
- Invalid/missing coordinates: `CodedException(ExitCodes.UNKNOWN, "ip-geo returned invalid data")`.

## Data shapes

- IpGeoResponse
  - double lat
  - double lon
  - String status
  - String message

## Notes

- Keep mapping minimal to avoid coupling. Do not implement retries here.
- The service will be used synchronously by the weather command flow.
