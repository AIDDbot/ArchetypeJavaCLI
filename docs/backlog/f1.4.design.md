# F1.4 Structured logging baseline — Design

Status: ✏️ DESIGNED

## Scope

Introduce structured JSON logging using Spring Boot + Logback, output to stdout only, configurable levels via environment variables, and minimal app metadata enrichment.

## Containers and Components

- CLI (Spring Boot, Spring Shell)
  - Logback as logging backend
  - Spring Boot logging system to apply configuration
  - `logback-spring.xml` config file under `src/main/resources`

## Interactions

- Application code and dependencies log via SLF4J -> Logback
- Logback encodes events as JSON -> stdout
- Log level set via Spring Boot properties/env vars (e.g., `LOGGING_LEVEL_ROOT`)

## Data Model

Log event fields (per line JSON):
- timestamp, level, logger, thread, message
- exception (if present)
- mdc (map)
- app, version (from Spring properties)

## Configuration Approach

- Use a `logback-spring.xml` leveraging Spring property placeholders to inject:
  - `${spring.application.name}` as `app`
  - `${app.version}` as `version`
  - `${LOGGING_LEVEL_ROOT:-INFO}` default
- Prefer Spring Boot native JSON layout if available; otherwise, implement a compact pattern with key=value pairs that is JSON-safe via encoder.

Given Boot 3.3, we’ll use Logback with `net.logstash.logback` JSON encoder for robust JSON. Add dependency.

## Edge Cases

- Missing env variables -> use defaults
- Non-JSON-safe messages -> encoder handles escaping
- Performance: keep async disabled for simplicity (CLI)

## Decisions

- Add dependency `net.logstash.logback:logstash-logback-encoder`
- Provide `logback-spring.xml` with ConsoleAppender + JSON encoder, include MDC and app metadata
- Expose env-based level via Spring property `logging.level.root` honoring `LOGGING_LEVEL_ROOT` env var
