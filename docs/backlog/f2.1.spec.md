---
description: 'Specification for F2.1 Reactive HTTP client with timeouts'
---

# F2.1 Reactive HTTP client with timeouts Specification

Provide a preconfigured reactive HTTP client (Spring WebClient) with connect/read timeouts and sensible defaults, honoring environment-driven configuration.

- Epic: E2 Networking and Integrations Foundation
- Priority: ‼️ Critical
- Product Requirements:
  
  - R3 Configuration via environment variables
  - R7 Non-functional requirements

## User Story 1

- As a developer
- I want to have a singleton, preconfigured WebClient with sane timeouts
- So that I can call external APIs reliably without hanging the CLI

### Acceptance Criteria

- [ ] The system SHALL expose a singleton WebClient bean configured with both connect and read timeouts driven by configuration (apiTimeoutMs).
- [ ] WHEN the apiTimeoutMs environment variable is not set, THEN the WebClient SHALL use a default timeout of 3000 ms for both connect and read timeouts.
- [ ] IF apiTimeoutMs is set to a non-positive or non-numeric value, THEN the configuration SHALL fall back to the default timeout and log a warning.
- [ ] WHEN an outbound HTTP call exceeds the configured timeout, THEN a timeout error SHALL be raised to the caller for consistent error handling by the CLI (per F1.5).

## User Story 2

- As a developer
- I want JSON-friendly defaults on the WebClient
- So that external services accept requests and responses with minimal boilerplate

### Acceptance Criteria

- [ ] The WebClient SHALL send requests with Accept: application/json by default.
- [ ] WHERE the application version is available, the WebClient SHALL include a default User-Agent header in the form "ArchetypeJavaCLI/<version>"; WHEN the version is not available, THEN a sensible fallback SHALL be used (e.g., "ArchetypeJavaCLI").
- [ ] WHILE making outbound requests, the WebClient SHALL support HTTPS by default.

> End of Feature Specification for F2.1, last updated 2025-08-28.
