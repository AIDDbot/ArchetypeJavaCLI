# Structure for ArchetypeJavaCLI

## Overview

ArchetypeJavaCLI is a Spring Boot-based Java command-line application scaffold that demonstrates how to build CLI apps with Spring Shell, structured logging, and a small sample command (weather). The repository provides documentation, tests, and a reproducible Maven build.

## Bill of Materials

- Language: Java 21
- Framework: Spring Boot
- CLI tooling: Spring Shell
- Build tool: Maven
- Testing: JUnit 5, Maven Surefire
- Logging: Logback with logstash encoder

### Development / Deployment workflow

- Development:
  - Use Java 21 and Maven 3.9+.
  - Run tests locally with `mvn test` or `mvn -Dtest=*UnitTest test` for unit-only.
  - Use `mvn -q spring-boot:run` to start the CLI in development with hot reload of code after rebuilds.

- Packaging/Release:
  - Build a distributable JAR with `mvn -DskipTests package`.
  - Ship the resulting `target/archetype-java-cli-0.1.0-SNAPSHOT.jar`.

- CI/CD:
  - Typical pipeline: `mvn -B -DskipTests clean package` followed by running tests and publishing artifacts.

## Folder Structure

Top-level layout (important folders and files):

- `src/main/java/` - Application source code.
- `src/main/resources/` - Application resources (configuration, banner, logging config).
- `src/test/java/` - Test sources.
- `src/test/resources/` - Test resources and test-specific config.
- `docs/` - Project documentation (PRD, DOMAIN, SYSTEMS, BACKLOG, MANUAL, STRUCTURE).
- `target/` - Build output (generated by Maven).
- `logs/` - Example runtime logs (not committed in normal flows).

### Key files

- `pom.xml`: Maven build configuration and dependencies.
- `src/main/resources/application.properties`: Default Spring properties used at runtime.
- `src/main/resources/logback-spring.xml`: Logging configuration (structured JSON output).
- `docs/STRUCTURE.md`: This file, describing how the project is organized.
- `README.md`: Top-level project description and quick start.

## Components diagram

```mermaid
C4Component
title Component diagram for ArchetypeJavaCLI - CLI Application

System_Ext(ipGeoApi, "IP Geolocation API", "External HTTP API")
System_Ext(openMeteoApi, "Open-Meteo API", "External HTTP API")

Container_Boundary(cli_app, "CLI Application") {
  Component(main, "ArchetypeJavaCliApplication", "Spring Boot application", "Application entry point â€” boots Spring context and wires components")
  Component(shell, "Shell Command Layer", "Spring Shell", "Registers CLI commands and routes user input to commands")
  Component(weatherCmd, "WeatherCommand", "Spring Shell Command", "Command implementation: fetch and display weather for a location or IP")
  Component(weatherSvc, "WeatherService", "Spring @Service", "Orchestrates external calls, caching and result formatting")
  Component(httpClient, "HttpClient", "WebClient / RestTemplate", "Performs HTTP calls to external APIs and handles timeouts/retries")
  Component(config, "ConfigurationProperties", "Spring @ConfigurationProperties", "Holds endpoints, timeouts and feature flags")
  Component(logging, "Logging", "Logback + logstash encoder", "Structured JSON logging and custom fields (app, version)")
  Component(tests, "Unit Tests", "JUnit 5", "Unit tests for commands and services (fast, no Spring context where possible)")
}

Rel(shell, weatherCmd, "invokes")
Rel(weatherCmd, weatherSvc, "calls")
Rel(weatherSvc, httpClient, "uses", "HTTP/JSON")
Rel(httpClient, ipGeoApi, "calls", "HTTP/JSON")
Rel(httpClient, openMeteoApi, "calls", "HTTP/JSON")
Rel(weatherSvc, config, "reads")
Rel(weatherSvc, logging, "writes logs to", "JSON")

UpdateRelStyle(weatherCmd, weatherSvc, $offsetX="-20", $offsetY="10")
UpdateRelStyle(httpClient, ipGeoApi, $offsetY="-10")
UpdateLayoutConfig($c4ShapeInRow="3")

```

> End of STRUCTURE for ArchetypeJavaCLI, last updated on 2025-09-02.
